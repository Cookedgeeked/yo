2025.11.15

.ssh はディレクトリ、その人専用の見えない道具箱
先頭に　. 隠しディレクトリ
sshに使う鍵や、設定ファイルを入れておくための専用の秘密フォルダ

中に入っているものの例
id_rsa 秘密鍵
(あなた自身　identity + RSAという暗号方式、発明した人達の名前の頭文字　Rivest,Shamir, Adleman 秘密鍵を呼ばれるけどあなたがあなたであることを示す、波動の署名みたいなもの）


id_rsa.pub 公開鍵
known_hosts 知ってるサーバーのリスト
config　設定

ディレクトリ構造
/home/ユーザー名/.ssh



.bashrc はbashシェルが起動するたびに読む設定ファイル
ユーザーごとに存在、/home/ユーザー名/.bashrc
rc=run commands 起動時に実行するコマンド集


SSHに入るまでの流れ
（＝サーバーが本物かどうか確かめる時間）
「果物屋さんが本物か確認する方法」

１果物屋さん（サーバー）が自分の店の看板を客（クライアントに見せる）
/etc/ssh にある公開鍵
＝店がこれが本物のうちの看板です

２客は家にある知ってる店の看板メモと見比べる
known_hosts
=この看板、前に書き留めたのと同じだ
→偽の果物屋に騙されない

３　２人だけの秘密の合言葉を決める
　　　　　　　　　　暗号の種交換

４　会話はその合言葉で暗号化
種をもとにほかの誰にも分からない同じ果物を育て、共通鍵を使って会話
共通鍵で暗号化
会話が全部「みかん語」みたいになる
盗み聞きされてもわからない



ーーーここまでで、本物の店の確認、＋盗み聞き防止の準備


公開鍵認証

（＝自分が本物のいつものお客さんかを説明する）
果物屋でこのカード持ってる人だけ入れるよ


１　家は自分のお客さんカード（”秘密鍵”）の封を開ける
　パスフレーズ＝カードの箱にかかった紐をほどく、なければ不要

２　客はそのカードを使って、「本人ですサイン」を作る
　秘密鍵で署名、＝店に渡すサインカード

３　果物屋へそのサインカードを渡す

↑
↓署名と公開鍵の照合は暗号的に計算して波動が合うか見る作業
　実際にはカードにはメッセージと、それを秘密鍵でねじった数字が入ってる、この数字は秘密鍵持ってないと作れない、サーバーは「数字のねじれ」を公開鍵で計算すると、正しいかどうか分かる仕組みどれかの公開鍵で正しければ認証成功　　


４　店は登録されたお客さん名簿（”公開鍵”）で確認する

果物屋は前もらったお客さん一覧（authorized-keys)で照合する
お店（サーバー）に入れるお客さんの名札リストみたいなもの客の公開鍵リスト、なければ入れない
サインが偽物でない
持ち主正しい
→ログイン成功、店の秘密鍵で秘密の倉庫（サーバーの中の安全な場所、お店だけが持ってる情報、ファイルがある）を開ける


これらはほとんど自動で行われる。（いつも）
ssh user@host
でも裏では、SSHクライアントが勝手にこういう儀式を始めます：
known_hosts で相手の“波動リスト”チェック
対象サーバーから「このメッセージに署名して」挑戦を受け取る
もし秘密鍵があれば、裏でカード署名をつくる
署名カードをサーバーへ返す
サーバーが authorized_keys の公開鍵で照合する
これ全部、あなたが何も書かなくても 自動で行われる裏の儀式。



ssh -i id_rsa user@host
これは宇宙的には：

「はいはい、今日は“秘密鍵での入場儀式”やりたいです〜」
と宣言した状態。

この瞬間：

クライアントが秘密鍵を読み込む
パスフレーズ要求（鍵の封印解除）
署名カード儀式スタート
サーバーが authorized_keys の公開鍵リストで照合
成功なら入場
あなたは何もしてないように見えるけど、裏ではずっと “署名カードを



SSHのアクセス方式・本質は2種類
1. パスワード方式（あなたの“人間の声”で名乗る）

ssh user@host
サーバー「あなた誰？」
あなた「パスワードこれです」
サーバー「OK、入ってどうぞ」
これはただ 言葉で自己紹介する方式。
宇宙的には「肉体レベルの本人確認」。


公開鍵方式（“魂の波動で”名乗る）

ssh -i id_rsa user@host
クライアントが裏でカードを署名して送りつける
サーバーは公開鍵リストでその波動をチェック
合えば入場
これは あなたの波動（秘密鍵）で証明する方式。



ssh2johnとは？
John the Ripper というパスワード解析ツール用のフォーマット変換ツールです。
目的は SSH秘密鍵にかけられたパスフレーズを解析できる形に変えること。
要するに、秘密鍵の「パスフレーズロック」をJohn the Ripperに読ませられる形に変換するツールです。
ssh2john = 秘密鍵のパスフレーズを「解析可能な形」に変換するツール
Pythonで動く版あり
本質的には「秘密鍵のロック（パスフレーズ）を突破する準備ツール」


LinPEASの目的

Linuxサーバーにログインしたあとに 「ここに隠れたチャンスや弱点があるか」 を自動で調べるスクリプトです。

目的は 権限昇格（privilege escalation）や情報収集の下準備。


フォルダ探して
設定見て
SUIDバイナリ探して
cron見て
sudo権限探して
パスワードメモ落ちてないか見て
どのサービス動いてるか調べて
脆弱なバージョン手作業で確認して
…みたいな「人力でやるとめちゃ重い儀式」を全部自動で代行してくれる。
ユーザー情報
現在のユーザー、sudo権限の有無、パスワードが設定されていないユーザーなど
ファイル・ディレクトリ
書き込み可能な重要ファイル（rootが持ってるのに書き換えられるもの）
パスワードや秘密鍵の存在
ソフトウェアとサービス
古いバージョンで脆弱性のあるソフト
実行中のサービス
環境変数や設定
PATHの中の怪しいディレクトリ
cronジョブ、スケジューラーなど
権限昇格のヒント
sudo可能コマンド
SUIDバイナリ
使われていないroot権限付きファイ

直接何か壊すわけじゃなくて、「ここならチャンスあるよ」と教えてくれるスパイです。





















